
{% with summary_id|default:"quick-summary" as sid %}
<div class="form-check mb-2 m-3">
  <input type="checkbox" class="form-check-input" id="select-all-quick">
  <label class="form-check-label ps-2" for="select-all-quick">Select All Users</label>
</div>

{% for user in users %}
  <div class="dropdown-option">
    <input type="checkbox"
           name="selected_users"
           value="{{ user.id }}"
           class="form-check-input quick-user-checkbox"
           id="quick-user-{{ user.id }}"
           {% if user.id|stringformat:"s" in selected_ids %}checked{% endif %}>
    <label class="form-check-label" for="quick-user-{{ user.id }}">
      {{ user.last_name }}, {{ user.first_name }} ({{ user.email }}) ({{ user.employer.name }})
    </label>
  </div>
{% empty %}
  <p class="text-muted px-2">No users found.</p>
{% endfor %}

<script>
  function updateQuickUserSummary() {
    const checked = document.querySelectorAll(".quick-user-checkbox:checked");
    const label = document.getElementById("quick-summary-label");
    if (label) {
      const count = checked.length;
      label.textContent = count > 0 ? `${count} user${count > 1 ? "s" : ""} selected` : "Select Users";
    }
  }

  function bindQuickCheckboxHandlers() {
    const selectAll = document.getElementById("select-all-quick");
    const checkboxes = document.querySelectorAll(".quick-user-checkbox");

    if (selectAll) {
      selectAll.checked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
      selectAll.addEventListener("change", function () {
        checkboxes.forEach(cb => cb.checked = this.checked);
        updateQuickUserSummary();
      });
    }

    checkboxes.forEach(cb => {
      cb.addEventListener("change", updateQuickUserSummary);
    });

    updateQuickUserSummary();
  }

  document.addEventListener("DOMContentLoaded", bindQuickCheckboxHandlers);
  document.addEventListener("htmx:afterSwap", function (e) {
    if (e.detail.target.id === "quick-user-checkbox-list") {
      bindQuickCheckboxHandlers();
    }
  });
</script>
{% endwith %}