{% extends "../base/base.html" %}
{% block title %}Index{% endblock %}

{% block template %}
{% include "../base/navbar.html" %}
{% load crispy_forms_tags %}
{{ form|as_crispy_errors }}


<div class="container">
    <div class="row justify-content-center pt-5 mt-5"></div>
    <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-6">
  

  <legend>Checklist Dashboard</legend>

<ul class="nav nav-tabs flex-wrap text-center" id="checklistTabs">
  <li class="nav-item">
    <a class="nav-link active" data-bs-toggle="tab" href="#available">
      Available <br>
      <span class="badge bg-light text-dark">{{ templates|length }}</span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#inprogress">
      In Progress <br>
      <span class="badge bg-light text-dark">{{ drafts|length }}</span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#submitted">
      Submitted <br>
      <span class="badge bg-light text-dark">{{ submitted|length }}</span>
    </a>
  </li>
</ul>

  <!-- Tab panes -->
  <div class="tab-content border border-top-0 p-3 bg-white">

 
   <!-- Available -->
<div class="tab-pane fade show active" id="available" role="tabpanel" aria-labelledby="available-tab">
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      
      <tbody>
        {% for t in templates %}
          <tr>
            <td class="fw-semibold">
              {{ t.name }}
              <!-- Small-screen meta -->
              {% if t.description %}
                <div class="small text-muted d-md-none mt-1">
                  {{ t.description }}
                </div>
              {% endif %}
            </td>

            <!-- Hidden on < md -->
            <td class="d-none d-md-table-cell">
              {{ t.description|default:"—" }}
            </td>

            <td class="d-flex gap-2">
              <a class="btn btn-sm btn-outline-primary py-1"
                 href="{% url 'checklist_from_template' template_id=t.pk %}">
                Start
              </a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="3" class="text-muted">No templates available.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

    <!-- In Progress -->
<div class="tab-pane fade" id="inprogress" role="tabpanel">
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <!-- Show headers on md+; hide on mobile -->
      <thead class="table-light d-none d-md-table-header-group">
        <tr>
          <th>Title</th>
          <th>Created</th>
          <th>Store</th>
          <th>By</th>
          <th style="width:140px;">Action</th>
        </tr>
      </thead>
      <tbody>
      {% for c in drafts %}
        <tr>
          <!-- Desktop cells -->
          <td class="d-none d-md-table-cell fw-semibold">{{ c.title }}</td>
          <td class="d-none d-md-table-cell">{{ c.created_at|date:"Y-m-d H:i" }}</td>
          <td class="d-none d-md-table-cell">
            {% if c.store %}
              {% if c.store.number %}Store {{ c.store.number }}{% else %}{{ c.store }}{% endif %}
              {% if c.store.city %}<span class="text-muted"> · {{ c.store.city }}</span>{% endif %}
            {% else %}—{% endif %}
          </td>
          <td class="d-none d-md-table-cell">
            {% if c.created_by %}{{ c.created_by.get_full_name|default:c.created_by }}{% else %}—{% endif %}
          </td>
          <td class="d-none d-md-table-cell">
            <a class="btn btn-sm btn-outline-primary""
               href="{% url 'checklist_edit' slug=c.slug %}">Resume</a>
          </td>

          <!-- Mobile stacked cell -->
          <td class="d-table-cell d-md-none" colspan="5">
            <div class="d-flex justify-content-between align-items-start">
              <div class="me-2">
                <div class="fw-semibold">{{ c.title }}</div>
                <div class="text-muted small">
                  {% if c.store %}
                    {% if c.store.number %}Store {{ c.store.number }}{% else %}{{ c.store }}{% endif %}
                    {% if c.store.city %} · {{ c.store.city }}{% endif %}
                  {% else %}—{% endif %}
                </div>
                <div class="text-muted small">
                  {% if c.created_by %}by {{ c.created_by.get_full_name|default:c.created_by }}{% else %}by —{% endif %}
                </div>
                <div class="text-muted small">Created: {{ c.created_at|date:"Y-m-d H:i" }}</div>
              </div>
              <div>
                <a class="btn btn-sm btn-outline-primary"
                   href="{% url 'checklist_edit' slug=c.slug %}">Resume</a>
              </div>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="text-muted">No drafts.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

        <!-- Submitted -->
<div class="tab-pane fade" id="submitted" role="tabpanel">
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead class="table-light d-none d-md-table-header-group">
        <tr>
          <th>Title</th>
          <th>Submitted</th>
          <th>Store</th>
          <th>By</th>
          <th style="width:140px;">Action</th>
        </tr>
      </thead>
      <tbody>
      {% for c in submitted %}
        <tr>
          <!-- Desktop cells -->
          <td class="d-none d-md-table-cell fw-semibold">{{ c.title }}</td>
          <td class="d-none d-md-table-cell">{{ c.submitted_at|date:"Y-m-d H:i" }}</td>
          <td class="d-none d-md-table-cell">
            {% if c.store %}
              {% if c.store.number %}Store {{ c.store.number }}{% else %}{{ c.store }}{% endif %}
              {% if c.store.city %}<span class="text-muted"> · {{ c.store.city }}</span>{% endif %}
            {% else %}—{% endif %}
          </td>
          <td class="d-none d-md-table-cell">
            {% if c.submitted_by %}{{ c.submitted_by.get_full_name|default:c.submitted_by }}{% else %}—{% endif %}
          </td>
          <td class="d-none d-md-table-cell">
            <a class="btn btn-sm btn-outline-primary""
               href="{% url 'checklist_detail' slug=c.slug %}">View</a>
          </td>

          <!-- Mobile stacked cell -->
          <td class="d-table-cell d-md-none" colspan="5">
            <div class="d-flex justify-content-between align-items-start">
              <div class="me-2">
                <div class="fw-semibold">{{ c.title }}</div>
                <div class="text-muted small">
                  {% if c.store %}
                    {% if c.store.number %}Store {{ c.store.number }}{% else %}{{ c.store }}{% endif %}
                    {% if c.store.city %} · {{ c.store.city }}{% endif %}
                  {% else %}—{% endif %}
                </div>
                <div class="text-muted small">
                  {% if c.submitted_by %}by {{ c.submitted_by.get_full_name|default:c.submitted_by }}{% else %}by —{% endif %}
                </div>
                <div class="text-muted small">Submitted: {{ c.submitted_at|date:"Y-m-d H:i" }}</div>
              </div>
              <div>
                <a class="btn btn-sm btn-outline-primary""
                   href="{% url 'checklist_detail' slug=c.slug %}">View</a>
              </div>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="text-muted">No submitted checklists.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
  </div>

</div>
</div>

</div>
</div>

{% endblock %}